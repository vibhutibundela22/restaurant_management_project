from django.db import models
from rest_framework import serializers
from rest_framework.views import APIView
from rest_framework.response import Response
from django.url import path 

class Reservation(models.Model):
    STATUS = [("pending", "Pending"),
              ("confirmed", "Confirmed"),
              ("cancelled", "Cancelled") 
    ]
    name=models.CharField(max_length=100)
    date=models.DateField()
    time=models.TimeField()
    guests=models.IntegerField()
    status=models.CharField(max_length=20,choices=STATUS,default="pending")

class ResStatusSer(serializers.ModelSerializer):
    class Meta:
        models=Reservation; 
        fields=["status"]
        def validate_status(self,v):
            if v not in dict(Reservation.STATUS):
               raise serializers.ValidationError("Invalid") return v

class UpdateResStatus(APIView): 
    def patch(self,r,pk):
        try:
           obj=Reservation.objects.get(pk=pk)                    
           except:
                return Response({"error":"Not found"}, 404)
                s=ResStatusSer(obj, data=r.data, partial=True)
            return Response(s.data if s.is_valid() and not s.save() else s.errors)

urlpatterns = [
    path("reservation/<it:pk>/upate-status/", UpdateResStatus.as_view())
]                  